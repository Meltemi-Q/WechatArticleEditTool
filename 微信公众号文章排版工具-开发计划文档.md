# 微信公众号文章排版工具 - 最终开发计划文档

## 项目概述

基于产品需求文档，采用纯前端无服务器架构，在GitHub + Vercel免费额度内实现完整功能。

## 技术架构方案

### 核心技术栈
- **前端框架**: React 18 + TypeScript + Vite
- **UI组件**: Tailwind CSS + Lucide React图标
- **富文本编辑**: Quill.js + react-markdown
- **状态管理**: Zustand (轻量级)
- **本地存储**: Dexie.js (IndexedDB封装)
- **图片处理**: Canvas API (浏览器原生，免费)
- **部署平台**: Vercel (免费额度)

## UI设计规范与样式细节

### 设计系统配置
```javascript
// Tailwind 主题扩展配置
const designTokens = {
  colors: {
    primary: '#07C160',      // 微信绿色 - 主要按钮、选中状态
    secondary: '#0085FF',    // 蓝色 - 次要操作、链接
    dark: '#1A1A1A',        // 深色 - 页脚、深色文本
    light: '#F5F7FA',       // 浅色 - 背景、预览区
    gray: {
      50: '#F8FAFC',        // 工具栏背景
      100: '#F1F5F9',       // 卡片悬停
      200: '#E2E8F0',       // 边框
      300: '#CBD5E1',       // 分隔线
      400: '#94A3B8',       // 占位符
      500: '#64748B',       // 次要文本
      600: '#475569',       // 主要文本
      700: '#334155',       // 标题
      800: '#1E293B',       // 强调文本
    }
  },
  borderRadius: {
    'sm': '6px',           // 小元素圆角
    'md': '8px',           // 卡片圆角
    'lg': '12px',          // 大卡片圆角
    'xl': '16px',          // 预览区圆角
  },
  spacing: {
    'sidebar': '256px',     // 左侧边栏宽度
    'preview': '320px',     // 右侧预览区宽度
  }
}
```

### 组件样式规范

#### 1. 顶部导航栏
```css
.header {
  background: white;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  padding: 12px 16px;
}

.header-logo {
  display: flex;
  align-items: center;
  gap: 8px;
}

.header-logo i {
  font-size: 24px;
  color: #07C160;
}

.header-logo h1 {
  font-size: 20px;
  font-weight: 700;
  color: #1E293B;
}

.header-actions {
  display: flex;
  gap: 16px;
}

.header-button {
  padding: 8px 16px;
  border-radius: 8px;
  font-size: 14px;
  font-weight: 500;
  transition: all 0.2s ease;
}

.header-button--secondary {
  background: #F1F5F9;
  color: #475569;
}

.header-button--secondary:hover {
  background: #E2E8F0;
}

.header-button--primary {
  background: #07C160;
  color: white;
}

.header-button--primary:hover {
  background: #059652;
}
```

#### 2. 功能卡片组件
```css
.feature-card {
  background: white;
  border-radius: 8px;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
  padding: 20px;
  transition: all 0.3s ease;
  overflow: hidden;
}

.feature-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
}

.feature-icon {
  width: 48px;
  height: 48px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-bottom: 16px;
}

.feature-icon--blue {
  background: #DBEAFE;
  color: #2563EB;
}

.feature-icon--green {
  background: #DCFCE7;
  color: #16A34A;
}

.feature-icon--purple {
  background: #F3E8FF;
  color: #9333EA;
}

.feature-icon--yellow {
  background: #FEF3C7;
  color: #D97706;
}

.feature-title {
  font-size: 18px;
  font-weight: 600;
  color: #1E293B;
  margin-bottom: 8px;
}

.feature-description {
  font-size: 14px;
  color: #64748B;
  line-height: 1.5;
}
```

#### 3. 侧边栏导航
```css
.sidebar {
  width: 256px;
  flex-shrink: 0;
}

.sidebar-section {
  background: white;
  border-radius: 8px;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  padding: 16px;
  margin-bottom: 24px;
}

.sidebar-title {
  font-size: 18px;
  font-weight: 600;
  color: #1E293B;
  margin-bottom: 16px;
}

.sidebar-nav {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.sidebar-item {
  display: flex;
  align-items: center;
  padding: 10px 15px;
  border-radius: 6px;
  font-size: 14px;
  color: #475569;
  transition: all 0.2s ease;
  cursor: pointer;
}

.sidebar-item:hover {
  background: #F1F5F9;
}

.sidebar-item.active {
  background: #E6F7ED;
  color: #07C160;
  font-weight: 600;
}

.sidebar-item i {
  margin-right: 12px;
  width: 16px;
}
```

#### 4. 编辑器容器
```css
.editor-container {
  background: white;
  border-radius: 8px;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
  overflow: hidden;
  margin-bottom: 24px;
}

.editor-toolbar {
  background: #F8FAFC;
  border-bottom: 1px solid #E2E8F0;
  padding: 8px;
  border-top-left-radius: 8px;
  border-top-right-radius: 8px;
}

.toolbar-group {
  display: flex;
  align-items: center;
  gap: 4px;
}

.toolbar-select {
  margin-right: 12px;
  padding: 4px 8px;
  border: 1px solid #D1D5DB;
  border-radius: 4px;
  font-size: 14px;
}

.toolbar-button {
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 4px;
  transition: background 0.2s ease;
  cursor: pointer;
}

.toolbar-button:hover {
  background: #E5E7EB;
}

.toolbar-separator {
  margin: 0 8px;
  color: #D1D5DB;
}

.editor-content {
  padding: 24px;
  min-height: 500px;
  font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", sans-serif;
  font-size: 16px;
  line-height: 1.6;
  color: #374151;
}
```

#### 5. 微信预览区
```css
.wechat-preview {
  max-width: 377px;
  background: #F5F7FA;
  border-radius: 16px;
  box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
  overflow: hidden;
  position: relative;
}

.wechat-preview::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 40px;
  background: #07C160;
  border-radius: 16px 16px 0 0;
}

.wechat-content {
  font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", sans-serif;
  font-size: 16px;
  line-height: 1.6;
  color: #333;
  padding: 20px;
  margin-top: 40px;
}

.wechat-content h1 {
  font-size: 22px;
  font-weight: bold;
  margin: 20px 0 15px;
  color: #1A1A1A;
}

.wechat-content h2 {
  font-size: 18px;
  font-weight: bold;
  margin: 25px 0 15px;
  border-left: 4px solid #07C160;
  padding-left: 10px;
}

.wechat-content p {
  margin: 15px 0;
  color: #333;
}

.wechat-content ul {
  padding-left: 20px;
  margin: 15px 0;
}

.wechat-content li {
  margin-bottom: 8px;
}

.wechat-content blockquote {
  border-left: 3px solid #07C160;
  padding: 10px 15px;
  background: #f0fdf4;
  margin: 15px 0;
  border-radius: 0 4px 4px 0;
}

.wechat-content img {
  width: 100%;
  border-radius: 4px;
  margin: 20px 0;
}

.wechat-image-caption {
  text-align: center;
  color: #888;
  font-size: 14px;
  margin-top: 8px;
}
```

#### 6. 图片处理组件
```css
.image-preview {
  border-radius: 6px;
  overflow: hidden;
  position: relative;
  background: #F8FAFC;
}

.image-actions {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  background: rgba(0, 0, 0, 0.7);
  padding: 8px;
  display: flex;
  justify-content: space-around;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.image-preview:hover .image-actions {
  opacity: 1;
}

.image-action-button {
  color: white;
  font-size: 12px;
  background: transparent;
  border: none;
  cursor: pointer;
  padding: 4px 8px;
  border-radius: 4px;
}

.image-action-button:hover {
  background: rgba(255, 255, 255, 0.2);
}

.resize-handle {
  position: absolute;
  right: 5px;
  bottom: 5px;
  width: 20px;
  height: 20px;
  background: white;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
  cursor: se-resize;
}

.image-controls {
  padding: 16px;
  background: white;
  border-radius: 8px;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
}

.image-control-group {
  margin-bottom: 16px;
}

.image-control-label {
  display: block;
  font-size: 14px;
  font-weight: 500;
  color: #374151;
  margin-bottom: 8px;
}

.image-size-buttons {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 8px;
}

.image-size-button {
  padding: 8px 4px;
  background: #F3F4F6;
  border: 1px solid #E5E7EB;
  border-radius: 4px;
  font-size: 12px;
  text-align: center;
  cursor: pointer;
  transition: all 0.2s ease;
}

.image-size-button:hover {
  background: #E5E7EB;
}

.image-size-button.active {
  background: #07C160;
  color: white;
  border-color: #07C160;
}

.image-align-buttons {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 8px;
}

.image-align-button {
  padding: 8px;
  background: #F3F4F6;
  border: 1px solid #E5E7EB;
  border-radius: 4px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.2s ease;
}

.image-align-button:hover {
  background: #E5E7EB;
}

.image-align-button.active {
  background: #07C160;
  color: white;
  border-color: #07C160;
}
```

#### 7. 标题样式模板
```css
.style-templates {
  background: white;
  border-radius: 8px;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  padding: 20px;
  margin-bottom: 24px;
}

.template-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 16px;
}

.template-card {
  border: 1px solid #E5E7EB;
  border-radius: 8px;
  padding: 16px;
  cursor: pointer;
  transition: all 0.2s ease;
}

.template-card:hover {
  border-color: #07C160;
  box-shadow: 0 4px 6px rgba(5, 150, 105, 0.1);
}

.title-style-sample {
  border-left: 4px solid #07C160;
  padding: 8px 12px;
  margin: 8px 0;
  background: #F0FDF4;
  border-radius: 0 4px 4px 0;
}

.title-style-sample h3 {
  font-weight: bold;
  color: #1A1A1A;
  margin: 0;
}

.template-description {
  color: #64748B;
  font-size: 14px;
  margin-top: 8px;
}

/* 预设标题样式 */
.title-style-circle {
  display: inline-flex;
  align-items: center;
  gap: 8px;
}

.title-style-circle::before {
  content: counter(title-counter);
  counter-increment: title-counter;
  width: 24px;
  height: 24px;
  background: #007acc;
  color: white;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 14px;
  font-weight: bold;
}

.title-style-border {
  border-left: 4px solid #0085FF;
  padding-left: 12px;
  padding-top: 4px;
  padding-bottom: 4px;
}

.title-style-background {
  background: #F3F4F6;
  padding: 8px 12px;
  border-radius: 4px;
  display: inline-block;
}
```

#### 8. 专题管理卡片
```css
.topic-management {
  background: white;
  border-radius: 8px;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  padding: 24px;
  margin-top: 32px;
}

.topic-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 24px;
}

.topic-title {
  font-size: 24px;
  font-weight: 600;
  color: #1E293B;
}

.topic-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 24px;
}

.topic-card {
  border: 1px solid #E2E8F0;
  border-radius: 8px;
  overflow: hidden;
  transition: all 0.3s ease;
}

.topic-card:hover {
  border-color: #07C160;
  box-shadow: 0 4px 6px rgba(5, 150, 105, 0.1);
}

.topic-card-content {
  padding: 20px;
}

.topic-card-header {
  display: flex;
  align-items: flex-start;
  margin-bottom: 16px;
}

.topic-icon {
  width: 40px;
  height: 40px;
  border-radius: 6px;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-right: 12px;
  flex-shrink: 0;
}

.topic-icon--blue {
  background: #DBEAFE;
  color: #2563EB;
}

.topic-icon--green {
  background: #DCFCE7;
  color: #16A34A;
}

.topic-icon--purple {
  background: #F3E8FF;
  color: #9333EA;
}

.topic-name {
  font-size: 16px;
  font-weight: 600;
  color: #1E293B;
  margin: 0;
}

.topic-meta {
  font-size: 12px;
  color: #64748B;
  margin-top: 4px;
}

.topic-tags {
  display: flex;
  flex-wrap: wrap;
  gap: 4px;
}

.topic-tag {
  padding: 2px 8px;
  border-radius: 12px;
  font-size: 11px;
  font-weight: 500;
}

.topic-tag--blue {
  background: #DBEAFE;
  color: #1E40AF;
}

.topic-tag--green {
  background: #DCFCE7;
  color: #166534;
}

.topic-tag--purple {
  background: #F3E8FF;
  color: #7C3AED;
}

.topic-tag--yellow {
  background: #FEF3C7;
  color: #92400E;
}

.topic-tag--red {
  background: #FEE2E2;
  color: #DC2626;
}

.topic-tag--indigo {
  background: #E0E7FF;
  color: #3730A3;
}

.topic-card-actions {
  background: #F8FAFC;
  padding: 12px 20px;
  border-top: 1px solid #F1F5F9;
  display: flex;
  justify-content: space-between;
}

.topic-action-button {
  color: #64748B;
  background: transparent;
  border: none;
  padding: 8px;
  border-radius: 4px;
  cursor: pointer;
  transition: color 0.2s ease;
}

.topic-action-button:hover {
  color: #2563EB;
}

.topic-action-button--primary:hover {
  color: #2563EB;
}
```

#### 9. 技术栈展示区
```css
.tech-showcase {
  background: #F1F5F9;
  padding: 48px 0;
  margin-top: 48px;
}

.tech-title {
  font-size: 32px;
  font-weight: bold;
  text-align: center;
  color: #1E293B;
  margin-bottom: 16px;
}

.tech-description {
  text-align: center;
  color: #64748B;
  max-width: 512px;
  margin: 0 auto 40px;
  font-size: 16px;
  line-height: 1.6;
}

.tech-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  gap: 24px;
  max-width: 1200px;
  margin: 0 auto;
}

.tech-item {
  background: white;
  padding: 24px;
  border-radius: 8px;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  text-align: center;
}

.tech-item-icon {
  font-size: 48px;
  margin-bottom: 12px;
}

.tech-item-icon--react {
  color: #61DAFB;
}

.tech-item-icon--vite {
  color: #FFC119;
}

.tech-item-icon--typescript {
  color: #3178C6;
}

.tech-item-icon--tailwind {
  color: #06B6D4;
}

.tech-item-icon--database {
  color: #6366F1;
}

.tech-item-icon--cloud {
  color: #0EA5E9;
}

.tech-item-name {
  font-size: 16px;
  font-weight: 600;
  color: #1E293B;
  margin-bottom: 4px;
}

.tech-item-type {
  font-size: 12px;
  color: #64748B;
}
```

#### 10. 页脚样式
```css
.footer {
  background: #1A1A1A;
  color: white;
  padding: 32px 0;
}

.footer-content {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 24px;
}

@media (min-width: 768px) {
  .footer-content {
    flex-direction: row;
    justify-content: space-between;
  }
}

.footer-brand {
  display: flex;
  align-items: center;
  gap: 8px;
}

.footer-brand i {
  font-size: 24px;
  color: #07C160;
}

.footer-brand-name {
  font-size: 20px;
  font-weight: bold;
}

.footer-description {
  color: #9CA3AF;
  margin-top: 8px;
  font-size: 14px;
}

.footer-links {
  display: flex;
  gap: 24px;
}

.footer-link {
  color: #D1D5DB;
  font-size: 20px;
  transition: color 0.2s ease;
}

.footer-link:hover {
  color: white;
}

.footer-copyright {
  border-top: 1px solid #374151;
  margin-top: 32px;
  padding-top: 24px;
  text-align: center;
  color: #9CA3AF;
  font-size: 14px;
}
```

### 响应式设计规范

#### 断点定义
```css
/* 移动设备 */
@media (max-width: 640px) {
  .container {
    padding: 0 16px;
  }
  
  .sidebar {
    width: 100%;
    margin-bottom: 24px;
  }
  
  .main-layout {
    flex-direction: column;
  }
  
  .preview-area {
    width: 100%;
  }
  
  .wechat-preview {
    max-width: 100%;
  }
}

/* 平板设备 */
@media (min-width: 641px) and (max-width: 1024px) {
  .sidebar {
    width: 240px;
  }
  
  .preview-area {
    width: 280px;
  }
}

/* 桌面设备 */
@media (min-width: 1025px) {
  .sidebar {
    width: 256px;
  }
  
  .preview-area {
    width: 320px;
  }
}
```

### 动画和过渡效果

#### 统一过渡配置
```css
/* 基础过渡 */
.transition-base {
  transition: all 0.2s ease;
}

/* 悬停过渡 */
.transition-hover {
  transition: all 0.3s ease;
}

/* 弹性动画 */
.bounce-in {
  animation: bounceIn 0.6s ease-out;
}

@keyframes bounceIn {
  0% {
    opacity: 0;
    transform: scale(0.3);
  }
  50% {
    opacity: 1;
    transform: scale(1.05);
  }
  70% {
    transform: scale(0.9);
  }
  100% {
    opacity: 1;
    transform: scale(1);
  }
}

/* 淡入动画 */
.fade-in {
  animation: fadeIn 0.4s ease-out;
}

@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* 滑入动画 */
.slide-in-right {
  animation: slideInRight 0.5s ease-out;
}

@keyframes slideInRight {
  from {
    opacity: 0;
    transform: translateX(30px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}
```

### 数据存储策略
```
纯前端存储架构：
├── IndexedDB (主要存储)
│   ├── 文章草稿 (drafts)
│   ├── 历史文章专题 (topics)
│   ├── 用户设置 (settings)
│   └── 图片缓存 (images)
├── LocalStorage (配置缓存)
└── 可选：GitHub Gist (云端备份)
```

### 成本分析
- **开发成本**: 0元 (全部使用免费开源工具)
- **部署成本**: 0元 (Vercel免费额度足够)
- **维护成本**: 0元 (无服务器架构)
- **第三方服务**: 0元 (纯前端实现)

## 功能实现方案

### 1. 富文本编辑器
```javascript
// 基于原型设计的Quill.js配置
const editorConfig = {
  theme: 'snow',
  placeholder: '开始编写您的文章内容...',
  modules: {
    toolbar: {
      container: [
        [{ 'header': [1, 2, false] }],
      ['bold', 'italic', 'underline', 'strike'],
      [{ 'list': 'ordered'}, { 'list': 'bullet' }],
        ['blockquote', 'code-block'],
      ['link', 'image'],
      ['clean']
      ],
      handlers: {
        'image': function() {
          // 自定义图片处理逻辑
          selectLocalImage();
        }
      }
    },
    history: {
      delay: 1000,
      maxStack: 50,
      userOnly: true
    }
  },
  formats: [
    'header', 'bold', 'italic', 'underline', 'strike',
    'list', 'bullet', 'blockquote', 'code-block',
    'link', 'image'
  ]
}

// 工具栏按钮样式映射
const toolbarButtonStyles = {
  'ql-header': 'toolbar-select',
  'ql-bold': 'toolbar-button',
  'ql-italic': 'toolbar-button', 
  'ql-underline': 'toolbar-button',
  'ql-strike': 'toolbar-button',
  'ql-list': 'toolbar-button',
  'ql-blockquote': 'toolbar-button',
  'ql-link': 'toolbar-button',
  'ql-image': 'toolbar-button',
  'ql-clean': 'toolbar-button'
}
```

### 2. 图片处理模块
```javascript
// 基于原型设计的图片处理系统
const imageProcessor = {
  // 微信文章最佳宽度: 677px
  wechatOptimalWidth: 677,

  // 预设缩放比例 (对应原型中的四个按钮)
  presetRatios: [
    { name: '原始', value: 1.0, className: 'image-size-button' },
    { name: '大图', value: 0.8, className: 'image-size-button' },
    { name: '中等', value: 0.6, className: 'image-size-button active' },
    { name: '小图', value: 0.4, className: 'image-size-button' }
  ],

  // 对齐方式 (对应原型中的三个对齐按钮)
  alignmentOptions: [
    { name: 'left', icon: 'fas fa-align-left', className: 'image-align-button' },
    { name: 'center', icon: 'fas fa-align-center', className: 'image-align-button active' },
    { name: 'right', icon: 'fas fa-align-right', className: 'image-align-button' }
  ],

  // 智能自动缩放算法
  autoResize: (file) => {
    return new Promise((resolve) => {
      const canvas = document.createElement('canvas');
      const ctx = canvas.getContext('2d');
      const img = new Image();

      img.onload = () => {
        // 基于原型设计计算最佳尺寸
        const { width, height } = this.calculateOptimalSize(
          img.width,
          img.height,
          file.size
        );

        canvas.width = width;
        canvas.height = height;

        // 高质量渲染 (对应原型中的图片效果)
        ctx.imageSmoothingEnabled = true;
        ctx.imageSmoothingQuality = 'high';
        ctx.drawImage(img, 0, 0, width, height);

        // 输出质量基于文件大小
        const quality = file.size > 1024 * 1024 ? 0.7 : 0.9;
        resolve(canvas.toDataURL('image/jpeg', quality));
      };

      img.src = URL.createObjectURL(file);
    });
  },

  // 图片操作面板组件
  renderImageControls: (imageData) => {
    return {
      sizeControls: this.presetRatios.map(ratio => ({
        label: ratio.name,
        value: ratio.value,
        active: ratio.className.includes('active'),
        onClick: () => this.applyResize(imageData, ratio.value)
      })),
      alignControls: this.alignmentOptions.map(align => ({
        icon: align.icon,
        value: align.name,
        active: align.className.includes('active'),
        onClick: () => this.applyAlignment(imageData, align.name)
      })),
      captionInput: {
        placeholder: '输入图片描述',
        value: imageData.caption || '',
        onChange: (value) => this.updateCaption(imageData, value)
      }
    }
  }
}
```

### 3. 布局结构规范
```typescript
// 基于原型设计的主要布局组件
interface LayoutStructure {
  // 顶部导航栏
  header: {
    height: '64px',
    className: 'header',
    components: {
      logo: {
        icon: 'fab fa-weixin',
        text: '微信公众号文章排版工具',
        className: 'header-logo'
      },
      actions: {
        buttons: [
          {
            text: '历史版本',
            icon: 'fas fa-history',
            className: 'header-button header-button--secondary'
          },
          {
            text: '设置',
            icon: 'fas fa-cog',
            className: 'header-button header-button--secondary'
          },
          {
            text: '导出文章',
            icon: 'fas fa-download',
            className: 'header-button header-button--primary'
          }
        ]
      }
    }
  },

  // 主要内容区域
  main: {
    className: 'container mx-auto px-4 py-8',
    layout: 'three-column', // 对应原型的三栏布局
    components: {
      // 左侧边栏
      sidebar: {
        width: '256px',
        className: 'sidebar',
        sections: [
          {
            title: '功能导航',
            className: 'sidebar-section',
            items: [
              { icon: 'fas fa-edit', text: '编辑文章', active: true },
              { icon: 'fas fa-image', text: '图片管理' },
              { icon: 'fas fa-paint-brush', text: '样式设置' },
              { icon: 'fas fa-folder', text: '专题管理' },
              { icon: 'fas fa-history', text: '历史版本' },
              { icon: 'fas fa-cog', text: '系统设置' }
            ]
          },
          {
            title: '文章信息',
            className: 'sidebar-section',
            fields: [
              {
                label: '文章标题',
                type: 'input',
                placeholder: '输入文章标题',
                defaultValue: 'React开发最佳实践指南'
              },
              {
                label: '文章作者',
                type: 'input',
                placeholder: '输入作者名称',
                defaultValue: '前端技术团队'
              },
              {
                label: '封面图片',
                type: 'upload',
                className: 'border-dashed border-2 border-gray-300'
              }
            ]
          }
        ]
      },

      // 中间编辑区域
      editor: {
        className: 'flex-1',
        components: [
          {
            type: 'quill-editor',
            className: 'editor-container',
            config: 'editorConfig'
          },
          {
            type: 'style-templates',
            className: 'style-templates',
            title: '标题样式模板',
            templates: [
              {
                name: '圆形数字标题',
                preview: 'title-style-sample',
                description: '带圆形背景的数字编号标题'
              },
              {
                name: '左侧边框标题',
                preview: 'border-l-4 border-blue-500 pl-3 py-1',
                description: '左侧带有彩色边框的标题样式'
              },
              {
                name: '背景色块标题',
                preview: 'bg-gray-100 px-3 py-2 rounded',
                description: '带背景色块的标题样式'
              }
            ]
          }
        ]
      },

      // 右侧预览区域
      preview: {
        width: '320px',
        className: 'preview-area',
        sticky: true,
        components: [
          {
            type: 'wechat-preview',
            className: 'wechat-preview',
            title: '实时预览'
          },
          {
            type: 'image-controls',
            className: 'image-controls',
            title: '图片处理工具'
          }
        ]
      }
    }
  }
}
```

### 4. 样式管理系统
```typescript
// 基于原型设计的样式模板系统
interface StyleSystem {
  // 预设标题样式
  titleStyles: [
    {
      id: 'circle-number',
      name: '圆形数字标题',
      preview: '① 标题示例',
      css: `
        .title-circle {
          display: inline-flex;
          align-items: center;
          gap: 8px;
        }
        .title-circle::before {
          content: counter(title-counter);
          counter-increment: title-counter;
          width: 24px;
          height: 24px;
          background: var(--primary-color, #07C160);
          color: white;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 14px;
          font-weight: bold;
        }
      `,
      customizable: {
        backgroundColor: true,
        textColor: false,
        borderColor: false,
        fontSize: true
      }
    },
    {
      id: 'left-border',
      name: '左侧边框标题',
      preview: '▌ 标题示例',
      css: `
        .title-border {
          border-left: 4px solid var(--accent-color, #0085FF);
          padding-left: 12px;
          padding-top: 4px;
          padding-bottom: 4px;
          font-weight: bold;
        }
      `,
      customizable: {
        backgroundColor: false,
        textColor: true,
        borderColor: true,
        fontSize: true
      }
    },
    {
      id: 'background-block',
      name: '背景色块标题',
      preview: '■ 标题示例',
      css: `
        .title-background {
          background: var(--bg-color, #F3F4F6);
          padding: 8px 12px;
          border-radius: 4px;
          display: inline-block;
          font-weight: bold;
        }
      `,
      customizable: {
        backgroundColor: true,
        textColor: true,
        borderColor: false,
        fontSize: true
      }
    }
  ],

  // 颜色预设
  colorPresets: {
    primary: '#07C160',
    secondary: '#0085FF',
    accent: '#9333EA',
    warning: '#D97706',
    danger: '#DC2626',
    success: '#16A34A'
  },

  // 微信内容样式
  wechatStyles: {
    container: {
      maxWidth: '377px',
      fontFamily: '-apple-system, BlinkMacSystemFont, "Helvetica Neue", sans-serif',
      fontSize: '16px',
      lineHeight: '1.6',
      color: '#333'
    },
    title: {
      h1: {
        fontSize: '22px',
        fontWeight: 'bold',
        margin: '20px 0 15px',
        color: '#1A1A1A'
      },
      h2: {
        fontSize: '18px',
        fontWeight: 'bold',
        margin: '25px 0 15px',
        borderLeft: '4px solid #07C160',
        paddingLeft: '10px'
      }
    },
    content: {
      paragraph: {
        margin: '15px 0',
        color: '#333'
      },
      list: {
        paddingLeft: '20px',
        margin: '15px 0'
      },
      listItem: {
        marginBottom: '8px'
      },
      blockquote: {
        borderLeft: '3px solid #07C160',
        padding: '10px 15px',
        background: '#f0fdf4',
        margin: '15px 0',
        borderRadius: '0 4px 4px 0'
      }
    },
    image: {
      width: '100%',
      borderRadius: '4px',
      margin: '20px 0'
    },
    caption: {
      textAlign: 'center',
      color: '#888',
      fontSize: '14px',
      marginTop: '8px'
    }
  }
}
```

### 5. 专题管理功能
```typescript
// 基于原型设计的专题管理系统
interface TopicManager {
  // 专题数据结构
  topicStructure: {
    id: string,
    name: string,
    description?: string,
    icon: {
      type: 'fas' | 'fab',
      name: string,
      color: 'blue' | 'green' | 'purple' | 'yellow' | 'red'
    },
    articles: Array<{
      title: string,
      url: string,
      tags: Array<{
        text: string,
        color: 'blue' | 'green' | 'purple' | 'yellow' | 'red' | 'indigo'
      }>,
      addTime: Date,
      lastUpdate: Date
    }>,
    createdAt: Date,
    articleCount: number
  },

  // 专题卡片组件
  topicCardTemplate: {
    className: 'topic-card',
    structure: {
      header: {
        className: 'topic-card-content',
        elements: {
          iconContainer: {
            className: 'topic-icon topic-icon--{color}',
            size: '40px'
          },
          infoContainer: {
            title: {
              className: 'topic-name',
              fontSize: '16px'
            },
            meta: {
              className: 'topic-meta',
              format: '{count}篇文章 · 最后更新: {date}'
            }
          }
        }
      },
      tags: {
        className: 'topic-tags',
        tagClassName: 'topic-tag topic-tag--{color}'
      },
      actions: {
        className: 'topic-card-actions',
        buttons: [
          {
            icon: 'fas fa-edit',
            className: 'topic-action-button',
            action: 'edit'
          },
          {
            icon: 'fas fa-external-link-alt',
            className: 'topic-action-button',
            action: 'view'
          }
        ]
      }
    }
  },

  // 专题模板生成器
  templateGenerator: {
    // 生成专题文章列表模板
    generateListTemplate: (topic) => {
      return `
        <div class="topic-articles">
          <h2 class="topic-title">${topic.name}</h2>
          <p class="topic-description">${topic.description}</p>
          <div class="article-list">
            ${topic.articles.map((article, index) => `
              <div class="article-item">
                <span class="article-number">${index + 1}</span>
                <a href="${article.url}" class="article-link">
                  ${article.title}
                </a>
                <div class="article-tags">
                  ${article.tags.map(tag => `
                    <span class="tag tag--${tag.color}">${tag.text}</span>
                  `).join('')}
                </div>
              </div>
            `).join('')}
          </div>
        </div>
      `;
    },

    // 生成专题卡片展示模板
    generateCardTemplate: (topic) => {
      return `
        <div class="topic-showcase">
          <div class="topic-header">
            <div class="topic-icon topic-icon--${topic.icon.color}">
              <i class="${topic.icon.type} ${topic.icon.name}"></i>
            </div>
            <h3 class="topic-title">${topic.name}</h3>
          </div>
          <div class="topic-grid">
            ${topic.articles.map(article => `
              <div class="topic-article-card">
                <h4 class="article-title">${article.title}</h4>
                <div class="article-meta">
                  ${article.tags.map(tag => `
                    <span class="article-tag">${tag.text}</span>
                  `).join('')}
                </div>
              </div>
            `).join('')}
          </div>
        </div>
      `;
    }
  }
}
```

### 6. 交互逻辑规范
```typescript
// 基于原型设计的交互行为定义
interface InteractionLogic {
  // 侧边栏导航交互
  sidebarNavigation: {
    onItemClick: (itemId: string) => {
      // 更新激活状态
      document.querySelectorAll('.sidebar-item').forEach(item => {
        item.classList.remove('active');
      });
      document.querySelector(`[data-item="${itemId}"]`).classList.add('active');
      
      // 切换主内容区域
      this.switchMainContent(itemId);
    },
    
    onItemHover: (element: HTMLElement) => {
      if (!element.classList.contains('active')) {
        element.style.backgroundColor = '#F1F5F9';
      }
    },
    
    onItemLeave: (element: HTMLElement) => {
      if (!element.classList.contains('active')) {
        element.style.backgroundColor = '';
      }
    }
  },

  // 图片处理交互
  imageControls: {
    onSizeButtonClick: (ratio: number, buttonElement: HTMLElement) => {
      // 更新按钮状态
      document.querySelectorAll('.image-size-button').forEach(btn => {
        btn.classList.remove('active');
      });
      buttonElement.classList.add('active');
      
      // 应用缩放
      this.applyImageResize(ratio);
    },
    
    onAlignButtonClick: (alignment: string, buttonElement: HTMLElement) => {
      // 更新对齐按钮状态
      document.querySelectorAll('.image-align-button').forEach(btn => {
        btn.classList.remove('active');
      });
      buttonElement.classList.add('active');
      
      // 应用对齐
      this.applyImageAlignment(alignment);
    },
    
    onImageHover: (imageContainer: HTMLElement) => {
      // 显示操作按钮
      const actions = imageContainer.querySelector('.image-actions');
      if (actions) {
        actions.style.opacity = '1';
      }
    },
    
    onImageLeave: (imageContainer: HTMLElement) => {
      // 隐藏操作按钮
      const actions = imageContainer.querySelector('.image-actions');
      if (actions) {
        actions.style.opacity = '0';
      }
    }
  },

  // 样式模板交互
  styleTemplates: {
    onTemplateHover: (templateCard: HTMLElement) => {
      templateCard.style.borderColor = '#07C160';
      templateCard.style.boxShadow = '0 4px 6px rgba(5, 150, 105, 0.1)';
    },
    
    onTemplateLeave: (templateCard: HTMLElement) => {
      templateCard.style.borderColor = '#E5E7EB';
      templateCard.style.boxShadow = '';
    },
    
    onTemplateClick: (templateId: string) => {
      // 应用样式模板
      this.applyStyleTemplate(templateId);
      
      // 更新预览
      this.updatePreview();
    }
  },

  // 专题卡片交互
  topicCards: {
    onCardHover: (cardElement: HTMLElement) => {
      cardElement.style.borderColor = '#07C160';
      cardElement.style.boxShadow = '0 4px 6px rgba(5, 150, 105, 0.1)';
    },
    
    onCardLeave: (cardElement: HTMLElement) => {
      cardElement.style.borderColor = '#E2E8F0';
      cardElement.style.boxShadow = '';
    },
    
    onActionButtonClick: (action: string, topicId: string) => {
      switch (action) {
        case 'edit':
          this.openTopicEditor(topicId);
          break;
        case 'view':
          this.openTopicView(topicId);
          break;
      }
    }
  },

  // 实时预览同步
  previewSync: {
    onContentChange: debounce((content: string) => {
      // 更新微信预览区域
      this.updateWechatPreview(content);
    }, 300),
    
    onStyleChange: (styles: any) => {
      // 应用样式到预览区域
      this.applyStylesToPreview(styles);
    }
  }
}
```

### 7. 响应式交互适配
```typescript
// 移动端适配逻辑
interface ResponsiveAdaptation {
  breakpoints: {
    mobile: '640px',
    tablet: '1024px',
    desktop: '1025px'
  },

  mobileLayout: {
    // 移动端侧边栏转换为底部抽屉
    sidebarTransform: () => {
      const sidebar = document.querySelector('.sidebar');
      sidebar.classList.add('mobile-drawer');
    },
    
    // 预览区域转换为全屏模式
    previewTransform: () => {
      const preview = document.querySelector('.preview-area');
      preview.classList.add('mobile-fullscreen');
    },
    
    // 功能卡片单列显示
    featureCardsLayout: () => {
      const grid = document.querySelector('.feature-grid');
      grid.style.gridTemplateColumns = '1fr';
    }
  },

  // 触摸设备优化
  touchOptimization: {
    // 增大触摸目标
    enlargeButtons: () => {
      const buttons = document.querySelectorAll('.toolbar-button');
      buttons.forEach(btn => {
        btn.style.minWidth = '44px';
        btn.style.minHeight = '44px';
      });
    },
    
    // 优化滑动手势
    enableSwipeGestures: () => {
      // 侧边栏滑动开关
      this.setupSwipeDrawer();
      
      // 图片手势缩放
      this.setupImagePinchZoom();
    }
  }
}
```

## 项目结构设计

```
wechat-article-tool/
├── public/
│   ├── index.html
│   └── favicon.ico
├── src/
│   ├── components/
│   │   ├── Editor/
│   │   │   ├── QuillEditor.tsx
│   │   │   ├── MarkdownPreview.tsx
│   │   │   └── Toolbar.tsx
│   │   ├── ImageProcessor/
│   │   │   ├── ImageUpload.tsx
│   │   │   ├── ImageResize.tsx
│   │   │   └── ImagePreview.tsx
│   │   ├── StyleManager/
│   │   │   ├── TitleStyles.tsx
│   │   │   ├── ColorPicker.tsx
│   │   │   └── StylePresets.tsx
│   │   ├── TopicManager/
│   │   │   ├── TopicList.tsx
│   │   │   ├── ArticleForm.tsx
│   │   │   └── TemplateGenerator.tsx
│   │   └── Layout/
│   │       ├── Header.tsx
│   │       ├── Sidebar.tsx
│   │       └── Preview.tsx
│   ├── hooks/
│   │   ├── useEditor.ts
│   │   ├── useImageProcessor.ts
│   │   ├── useLocalStorage.ts
│   │   └── useTopicManager.ts
│   ├── stores/
│   │   ├── editorStore.ts
│   │   ├── imageStore.ts
│   │   └── topicStore.ts
│   ├── utils/
│   │   ├── imageUtils.ts
│   │   ├── htmlGenerator.ts
│   │   ├── storageUtils.ts
│   │   └── templateUtils.ts
│   ├── types/
│   │   ├── editor.ts
│   │   ├── image.ts
│   │   └── topic.ts
│   ├── styles/
│   │   ├── globals.css
│   │   └── components.css
│   ├── App.tsx
│   └── main.tsx
├── package.json
├── vite.config.ts
├── tailwind.config.js
├── tsconfig.json
└── README.md
```

## 开发阶段规划

### 第一阶段：项目初始化 (1-2天) ✅ 已完成
- [x] 创建Vite + React + TypeScript项目
- [x] 配置Tailwind CSS和基础样式
- [x] 设计基础布局组件
- [x] 配置状态管理和本地存储

### 第二阶段：核心编辑器 (3-4天) 🔄 部分完成
- [x] 集成Quill.js富文本编辑器
- [ ] 实现Markdown支持和预览 (待完善)
- [x] 添加实时预览功能
- [ ] 实现撤销重做功能 (需添加UI按钮)

### 第三阶段：图片处理 (2-3天) 🔄 部分完成
- [x] 图片上传和预览组件 (基础框架)
- [ ] Canvas图片缩放功能 (需完善)
- [ ] 图片居中和尺寸调整 (需功能实现)
- [ ] 图注添加功能 (需完善)
- [ ] 修复图片拖拽上传到编辑器功能

### 第四阶段：样式管理 (2-3天) 🔄 部分完成
- [x] 预设标题样式设计 (基础框架)
- [ ] 颜色选择器组件 (需实现)
- [ ] 样式应用和预览 (需功能实现)
- [ ] 自定义样式编辑器 (需实现)

### 第五阶段：专题管理 (3-4天) 🔄 部分完成
- [x] 专题CRUD操作 (UI已实现)
- [ ] 文章录入表单 (需功能实现)
- [ ] 模板选择和生成 (需功能实现)
- [ ] 批量导入导出功能 (需实现)

### 第六阶段：输出和优化 (2-3天) 🔄 部分完成
- [x] 一键复制功能 (已实现，但需修正复制内容)
- [x] HTML源码查看
- [ ] 性能优化和测试
- [ ] 微信兼容性验证

## 当前开发进度总结

### ✅ 已完成的核心功能
1. **项目架构搭建**：100% 完成
2. **基础UI布局**：90% 完成  
3. **富文本编辑器**：70% 完成
4. **状态管理系统**：85% 完成
5. **预览系统**：80% 完成
6. **导出功能**：75% 完成

### 🔄 需要完善的功能
1. **撤销重做按钮**：需要添加到编辑器工具栏
2. **图片上传功能**：需要修复拖拽和插入到编辑器
3. **样式模板应用**：需要实现点击切换功能
4. **复制功能优化**：需要复制预览内容而非HTML源码
5. **布局优化**：功能卡片位置调整
6. **导出位置优化**：移动到预览区上方

### ❌ 待开发的功能
1. **图片管理功能**：完整的图片处理和管理界面
2. **历史版本功能**：文章版本控制和恢复
3. **系统设置功能**：用户偏好设置和配置
4. **高级样式功能**：更多标题样式和自定义选项

## 依赖库详细清单

```json
{
  "dependencies": {
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "typescript": "^5.0.0",
    "quill": "^1.3.7",
    "react-quill": "^2.0.0",
    "react-markdown": "^9.0.0",
    "zustand": "^4.4.0",
    "dexie": "^3.2.0",
    "lucide-react": "^0.400.0",
    "tailwindcss": "^3.3.0"
  },
  "devDependencies": {
    "@types/react": "^18.2.0",
    "@types/react-dom": "^18.2.0",
    "@vitejs/plugin-react": "^4.0.0",
    "vite": "^5.0.0",
    "autoprefixer": "^10.4.0",
    "postcss": "^8.4.0"
  }
}
```

## 部署配置

### Vercel部署配置
```json
{
  "name": "wechat-article-tool",
  "version": 2,
  "builds": [
    {
      "src": "package.json",
      "use": "@vercel/static-build",
      "config": {
        "distDir": "dist"
      }
    }
  ],
  "routes": [
    {
      "src": "/(.*)",
      "dest": "/index.html"
    }
  ]
}
```

## 测试策略

### 单元测试
- 使用Vitest + React Testing Library
- 重点测试图片处理、样式生成、数据存储功能

### 集成测试
- 端到端功能流程测试
- 微信公众号兼容性测试

### 性能测试
- 大图片处理性能
- 大文档编辑响应速度
- 本地存储容量限制测试

## 风险控制

### 技术风险
1. **浏览器兼容性**: 使用现代浏览器API，提供降级方案
2. **存储容量限制**: IndexedDB通常有几GB限制，对用户提供清理工具
3. **图片处理性能**: 大图片使用Web Workers异步处理

### 用户体验风险
1. **学习成本**: 提供详细使用指南和示例
2. **数据丢失**: 实现自动保存和导出备份功能

## 后续维护计划

### 版本迭代
- v1.0: MVP功能完整实现
- v1.1: 用户反馈优化
- v1.2: 性能优化和新功能
- v2.0: 高级功能扩展

### 社区建设
- GitHub开源项目
- 用户反馈收集
- 功能需求投票
- 贡献者指南

---

**确认要点：**
1. ✅ 完全免费的技术方案
2. ✅ 无服务器架构，零运维成本
3. ✅ 在Vercel免费额度内可完整实现
4. ✅ 所有依赖库都是免费开源
5. ✅ 详细的开发步骤和时间规划

## 关键技术实现细节

### 微信公众号兼容性保证
```css
/* 微信文章样式兼容 */
.wechat-content {
  max-width: 677px;
  margin: 0 auto;
  font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", sans-serif;
  font-size: 16px;
  line-height: 1.6;
  color: #333;
}

.wechat-image {
  display: block;
  margin: 10px auto;
  max-width: 100%;
  height: auto;
}
```

### 本地存储数据结构
```typescript
interface StorageSchema {
  drafts: {
    id: string;
    title: string;
    content: string;
    htmlContent: string;
    lastModified: Date;
    autoSave: boolean;
  };

  topics: {
    id: string;
    name: string;
    description?: string;
    articles: Array<{
      title: string;
      url: string;
      tags: string[];
      addTime: Date;
    }>;
    createdAt: Date;
  };

  settings: {
    theme: 'light' | 'dark';
    autoSave: boolean;
    previewMode: 'mobile' | 'desktop';
    defaultImageSize: number;
  };
}
```

### 图片处理核心算法
```javascript
class ImageProcessor {
  static WECHAT_MAX_WIDTH = 677;

  // 智能压缩算法
  static async smartCompress(file: File): Promise<string> {
    return new Promise((resolve) => {
      const canvas = document.createElement('canvas');
      const ctx = canvas.getContext('2d');
      const img = new Image();

      img.onload = () => {
        // 计算最佳尺寸
        const { width, height } = this.calculateOptimalSize(
          img.width,
          img.height,
          file.size
        );

        canvas.width = width;
        canvas.height = height;

        // 高质量渲染
        ctx.imageSmoothingEnabled = true;
        ctx.imageSmoothingQuality = 'high';
        ctx.drawImage(img, 0, 0, width, height);

        // 根据文件大小选择压缩质量
        const quality = file.size > 1024 * 1024 ? 0.7 : 0.9;
        resolve(canvas.toDataURL('image/jpeg', quality));
      };

      img.src = URL.createObjectURL(file);
    });
  }

  // 计算最佳尺寸
  static calculateOptimalSize(width: number, height: number, fileSize: number) {
    const ratio = Math.min(this.WECHAT_MAX_WIDTH / width, 1);

    // 大文件额外缩小
    const sizeRatio = fileSize > 2 * 1024 * 1024 ? 0.8 : 1;

    return {
      width: Math.floor(width * ratio * sizeRatio),
      height: Math.floor(height * ratio * sizeRatio)
    };
  }
}
```

### 样式模板系统
```typescript
interface TitleStyle {
  id: string;
  name: string;
  preview: string;
  css: string;
  customizable: {
    backgroundColor: boolean;
    textColor: boolean;
    borderColor: boolean;
    fontSize: boolean;
  };
}

const PRESET_STYLES: TitleStyle[] = [
  {
    id: 'circle-number',
    name: '圆形数字',
    preview: '① 标题示例',
    css: `
      .title-circle {
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }
      .title-circle::before {
        content: counter(title-counter);
        counter-increment: title-counter;
        width: 24px;
        height: 24px;
        background: #007acc;
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 14px;
        font-weight: bold;
      }
    `,
    customizable: {
      backgroundColor: true,
      textColor: true,
      borderColor: false,
      fontSize: true
    }
  }
];
```

## 开发环境配置

### 项目初始化命令
```bash
# 创建项目
npm create vite@latest wechat-article-tool -- --template react-ts

# 安装依赖
npm install quill react-quill react-markdown zustand dexie lucide-react

# 安装开发依赖
npm install -D tailwindcss postcss autoprefixer @types/quill

# 初始化Tailwind
npx tailwindcss init -p
```

### Vite配置优化
```typescript
// vite.config.ts
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

export default defineConfig({
  plugins: [react()],
  build: {
    rollupOptions: {
      output: {
        manualChunks: {
          'quill': ['quill', 'react-quill'],
          'markdown': ['react-markdown'],
          'utils': ['zustand', 'dexie']
        }
      }
    }
  },
  optimizeDeps: {
    include: ['quill', 'react-quill']
  }
})
```

## 质量保证措施

### 代码规范
- ESLint + Prettier配置
- TypeScript严格模式
- Git提交规范（Conventional Commits）

### 测试覆盖率目标
- 核心功能：90%以上
- 工具函数：100%
- 组件测试：80%以上

### 性能指标
- 首屏加载时间：< 2秒
- 图片处理响应：< 1秒
- 编辑器输入延迟：< 100ms

**下一步：** 请确认此开发计划，确认后将严格按照此文档逐步实施开发。

## 问题修复记录

### 2025-06-07 修复批次

**高优先级问题 (已完成):**

1.  **撤回/重做按钮图标优化**
    *   **问题描述**: 原始的 `↶` 和 `↷` 图标不够直观。
    *   **根本原因分析**: UI图标选择未遵循通用设计习惯，导致用户理解成本高。
    *   **解决方案**: 在 `src/components/Editor/QuillEditor.tsx` 中，将 `Quill.import('ui/icons')` 的 `undo` 和 `redo` 图标分别替换为更直观的 `←` 和 `→`。
    *   **修复状态**: ✅ 已完成

2.  **字体设置功能移除**
    *   **问题描述**: "默认字体大小"设置功能无效，调整后编辑器字体无变化。
    *   **根本原因分析**: 该功能通过直接操作 DOM 样式（`.ql-editor`) 来改变字体大小，但与Quill编辑器的内部渲染机制存在冲突或被覆盖，导致设置失效。且该功能与编辑器工具栏的功能定位重叠。
    *   **解决方案**:
        1.  从状态管理 `src/stores/settingsStore.ts` 中彻底移除 `fontSize` 状态和 `setFontSize` action。
        2.  从 `src/App.tsx` 的设置面板中移除了对应的"默认字体大小"UI选项。
    *   **修复状态**: ✅ 已完成

3.  **图片格式支持问题**
    *   **问题描述**: PNG格式图片无法插入，而非常见的TIFF格式却可以。
    *   **根本原因分析**: 初始的图片类型检查逻辑 `file.type.startsWith('image/')`过于宽泛，虽然允许了所有理论上的图片格式，但可能因浏览器、Quill或代码中其他未预料到的处理逻辑，导致对特定常见格式（如PNG）的处理出现问题。TIFF的成功可能是意外情况或浏览器兼容性的特殊表现。
    *   **解决方案**: 在 `src/components/Editor/QuillEditor.tsx` 的 `insertImageFile` 函数中，将图片类型检查改为白名单模式，明确支持 `['image/png', 'image/jpeg', 'image/jpg', 'image/gif', 'image/webp']`，并添加了日志记录以方便未来调试。
    *   **修复状态**: ✅ 已完成

4.  **编辑框布局问题**
    *   **问题描述**: 编辑器界面下方存在大量不必要的空白，且滚动功能体验不佳。
    *   **根本原因分析**:
        *   在 `src/components/Editor/QuillEditor.tsx` 中，组件根 `div` 上存在 `mb-6` 类，导致了固定的下外边距。
        *   在 `src/components/Editor/QuillEditor.css` 中，对 `.ql-container` 设置了 `max-height`，同时对 `.ql-editor` 设置了 `min-height`，这种固定高度的约束破坏了Flexbox布局的自适应性。
    *   **解决方案**:
        1.  移除了 `QuillEditor.tsx` 根 `div` 的 `mb-6` 类。
        2.  移除了 `QuillEditor.css` 中 `.ql-container` 的 `max-height` 和 `.ql-editor` 的 `min-height` 样式，使编辑器高度能完全由Flexbox动态管理。
    *   **修复状态**: ✅ 已完成

5.  **图片处理工具失效**
    *   **问题描述**: 多次尝试修复"图片处理工具"但无效果。
    *   **根本原因分析**: 经过对 `src/components/ImageProcessor/` 目录下所有相关组件（`ImageManager.tsx`, `ImageUpload.tsx`）的深入审查，确认项目中 **不存在** 任何形式的图片"处理"（如裁剪、旋转、滤镜等）功能。只提供了图片上传、预览、插入和删除的管理功能。因此，该问题是基于对项目功能范围的误解。
    *   **解决方案**: 无需代码更改。问题定性为需求澄清，非代码缺陷。
    *   **修复状态**: ✅ 已完成 (澄清)

6.  **专题文章添加功能故障**
    *   **问题描述**: 点击"添加当前文章"到专题后，提示成功但数据未持久化。
    *   **根本原因分析**: 在 `src/components/TopicManager/TopicManager.tsx` 的 `handleAddCurrentArticle` 函数中，虽然正确地更新了组件的本地 `topics` 状态，但没有调用 `saveTopics` 函数将更新后的数据写入 `localStorage`，导致页面刷新后数据丢失。
    *   **解决方案**: 在 `handleAddCurrentArticle` 函数的末尾，确保在更新本地状态后，调用 `saveTopics(updatedTopics)` 将数据持久化。同时，修复了 `author` 字段未能正确保存到文章对象中的问题。
    *   **修复状态**: ✅ 已完成

## 数据持久化与部署策略

### 数据持久化核心方案

为确保应用的稳定可靠（Solid）并坚守零成本原则，我们采用**以浏览器为中心**的数据持久化策略。核心技术为 **IndexedDB**，它是一个强大的浏览器内置客户端数据库，能够存储大量结构化数据，完美契合本项目需求。

#### 1. 存储技术选型
- **主要存储**: **IndexedDB**。
  - **原因**: 提供事务支持，可存储大量数据（通常是GB级别），支持索引查询，性能优于LocalStorage。是处理复杂数据（如文章、图片）的理想选择。我们将使用 `Dexie.js` 库来简化 IndexedDB 的操作。
- **次要存储**: **LocalStorage**。
  - **原因**: 用于存储简单的键值对，如用户界面设置（主题、开关状态等），读取速度快，适合存储少量、不关键的配置信息。

#### 2. 各模块数据存储设计

| 数据类型 | 存储方案 | 实现细节 |
| :--- | :--- | :--- |
| **文章内容与元数据** | IndexedDB | 创建一个名为 `articles` 的对象存储（Table），每条记录包含 `id`, `title`, `author`, `content` (HTML), `createdAt`, `updatedAt` 等字段。 |
| **上传的图片文件** | IndexedDB | 创建一个名为 `images` 的对象存储。图片文件在上传后被转换为 **Blob 对象** 或 **Base64 字符串**，与一个唯一 `id` 一起存入数据库。**优先选用 Blob**，因为它存储效率更高，性能更好。 |
| **专题管理数据** | IndexedDB | 创建一个名为 `topics` 的对象存储，用于存放专题列表、描述以及其包含的文章ID列表。这确保了专题与文章之间的关联。 |
| **历史版本数据** | IndexedDB | 创建一个名为 `history` 的对象存储，每条记录包含 `id`, `articleId`, `content`, `savedAt`。当用户保存或触发自动保存时，会创建一条新的历史版本记录。 |
| **用户设置和偏好** | LocalStorage + IndexedDB | 简单的UI状态（如激活的标签页）存储在 `LocalStorage` 中以快速读取。所有可配置的设置（如导出格式、自动保存开关）同时保存在 `IndexedDB` 的 `settings` 表中，作为数据备份和恢复的来源。 |

#### 3. 数据导入与导出功能

为了数据安全和迁移，必须提供强大的导入/导出功能。

- **导出功能**:
  1.  创建一个 `exportData` 函数，该函数会从 IndexedDB 中读取所有 `articles`, `images`, `topics`, `history`, 和 `settings` 表的数据。
  2.  将所有数据整合成一个单一的、结构化的 **JSON对象**。图片（Blob）在导出时将被转换为 Base64 字符串嵌入JSON中。
  3.  将这个JSON对象序列化后，生成一个 `.json` 文件（例如 `wechat-tool-backup-YYYY-MM-DD.json`），并触发浏览器下载。

- **导入功能**:
  1.  提供一个文件上传接口，允许用户选择之前导出的 `.json` 备份文件。
  2.  创建一个 `importData` 函数，该函数会解析上传的JSON文件。
  3.  **安全合并与覆盖**: 提供两种导入模式供用户选择："完全覆盖"或"增量合并"。
  4.  在执行写入操作前，对导入的数据进行严格的格式和类型验证，防止数据损坏。
  5.  使用 IndexedDB 的事务功能，将解析和验证后的数据批量写入相应的表中，确保导入过程的原子性。

---

### 部署指南

#### 方案一：Vercel 零成本部署 (推荐)

Vercel 提供了优秀的免费额度，与本项目纯前端的架构完美契合，是实现零成本部署的首选方案。

**步骤1：准备 GitHub 仓库**
- 确保你的项目代码已经提交到一个 GitHub 仓库中。这是 Vercel 进行自动部署的基础。

**步骤2：在 Vercel 上创建新项目**
1.  使用你的 GitHub 账户登录 [Vercel](https://vercel.com/)。
2.  在仪表盘（Dashboard）页面，点击 "Add New..." -> "Project"。
3.  从列表中选择你刚刚创建的 GitHub 仓库，并点击 "Import"。

**步骤3：配置项目**
- Vercel 会自动检测到这是一个 Vite 项目，并为你预填好大部分配置。
- **Framework Preset**: 确保选择了 `Vite`。
- **Build and Output Settings**:
  - **Build Command**: `npm run build` 或 `vite build` (通常Vercel会自动识别)。
  - **Output Directory**: `dist` (Vite的默认输出目录)。
  - **Install Command**: `npm install`。

**步骤4：环境变量**
- 由于这是一个纯前端、数据存储在客户端的应用，**无需配置任何服务器端环境变量**。所有逻辑都在用户的浏览器中运行。

**步骤5：部署**
- 点击 "Deploy" 按钮。Vercel 会自动拉取代码、安装依赖、构建项目并将其部署到全球CDN网络。
- 部署完成后，你将获得一个 `*.vercel.app` 的免费域名，点击即可访问你的应用。

**步骤6：自定义域名 (可选)**
1.  在你的 Vercel 项目仪表盘中，进入 "Settings" -> "Domains"。
2.  输入你自己的域名，并按照 Vercel 提供的指南，去你的域名注册商处添加 `A` 记录或 `CNAME` 记录。
3.  Vercel 会自动为你的自定义域名配置并续期免费的 SSL 证书。

#### 方案二：云服务器 ECS 部署

如果你已有云服务器（如阿里云ECS、腾讯云CVM等），也可以通过 Nginx 进行手动部署。

**步骤1：服务器环境准备**
- 确保你的服务器上安装了 `Node.js` (用于构建项目) 和 `Nginx` (用于托管静态文件)。
- 以 Ubuntu 为例，安装命令如下：
  ```bash
  sudo apt update
  sudo apt install -y nodejs npm nginx
  ```

**步骤2：项目构建与部署**
1.  在服务器上通过 `git` 克隆你的项目仓库：
    ```bash
    git clone https://github.com/your-username/your-repo.git
    ```
2.  进入项目目录，安装依赖并执行构建：
    ```bash
    cd your-repo
    npm install
    npm run build
    ```
3.  将构建产物（`dist` 目录下的所有文件）复制到 Nginx 的网站根目录，例如：
    ```bash
    sudo cp -r dist/* /var/www/html/
    ```

**步骤3：Nginx 配置**
1.  为你的应用创建一个新的 Nginx 配置文件：
    ```bash
    sudo nano /etc/nginx/sites-available/wechat-tool
    ```
2.  将以下配置粘贴到文件中，并将 `your-domain.com` 替换为你的域名或服务器IP：
    ```nginx
    server {
        listen 80;
        server_name your-domain.com;

        root /var/www/html;
        index index.html;

        location / {
            # 这个指令是关键，它确保了在使用React Router等前端路由时，
            # 刷新页面或直接访问子路径不会导致404错误。
            try_files $uri $uri/ /index.html;
        }
    }
    ```
3.  启用该配置并重启 Nginx：
    ```bash
    # 创建软链接以启用站点
    sudo ln -s /etc/nginx/sites-available/wechat-tool /etc/nginx/sites-enabled/
    
    # 测试配置是否正确
    sudo nginx -t

    # 重启Nginx使配置生效
    sudo systemctl restart nginx
    ```

**步骤4：域名与 SSL 证书配置**
- **域名解析**: 在你的域名提供商处，将域名的 `A` 记录指向你服务器的公网IP地址。
- **SSL证书**: 推荐使用 Let's Encrypt 的免费证书。可以通过 `Certbot` 工具自动完成配置。
  ```bash
  # 安装Certbot及其Nginx插件
  sudo apt install -y certbot python3-certbot-nginx

  # 自动为你的Nginx配置获取并安装证书
  sudo certbot --nginx -d your-domain.com
  ```
  Certbot 会自动修改你的 Nginx 配置以启用 HTTPS，并设置定时任务自动续期证书。

**步骤5：自动化部署脚本 (可选)**
- 为了简化更新流程，你可以创建一个简单的部署脚本 `deploy.sh`：
  ```bash
  #!/bin/bash
  echo "🚀 Starting deployment..."

  # 1. 拉取最新代码
  git pull origin main

  # 2. 安装依赖
  npm install

  # 3. 执行构建
  npm run build

  # 4. 同步文件到Nginx目录
  sudo rsync -av --delete dist/ /var/www/html/

  echo "✅ Deployment finished successfully!"
  ```
- 之后每次更新，只需在服务器上运行 `bash deploy.sh` 即可。
